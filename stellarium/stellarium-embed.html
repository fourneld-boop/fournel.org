<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stellarium Embed</title>
  <style>
    html, body { margin:0; height:100%; background:#000; }
    #app { width:100%; height:100%; }
  </style>
</head>
<body>
  <div id="app"></div>

  <!-- IMPORTANT: adjust this path to wherever your build placed the engine JS -->
  <script src="/stellarium/static/js/stellarium-web-engine.js"></script>

  <script>
    // ---- Helpers
    function clampYear(y) {
      y = parseInt(y, 10);
      if (!Number.isFinite(y)) return null;
      if (y < 1) return 1;
      if (y > 4000) return 4000;
      return y;
    }

    // Pick a representative moment so the sky “looks alive”
    // (mid-year, 22:00 UTC keeps it predictable)
    function yearToIso(y) {
      const yyyy = String(y).padStart(4, "0");
      return `${yyyy}-07-01T22:00:00Z`;
    }

    // ---- Stellarium init (implementation depends on your chosen demo/app)
    // This is intentionally defensive: once your engine is running,
    // you'll wire ONE of these setters to the actual API you have.
    function setEngineDateISO(iso) {
      // Try common patterns / globals (depends on which demo/app you host).
      // Open DevTools and see which object exists in your build.

      // Pattern A: a global "app" exposing a store/action (common in Stellarium Web client)
      if (window.app && window.app.setDateISO) { window.app.setDateISO(iso); return true; }

      // Pattern B: a global "core" with setDate (desktop Stellarium scripting has this; some builds expose similar)
      if (window.core && typeof window.core.setDate === "function") { window.core.setDate(iso, "utc"); return true; }

      // Pattern C: your own created engine instance:
      if (window.stel && typeof window.stel.setDate === "function") { window.stel.setDate(iso); return true; }

      return false;
    }

    function setYear(y) {
      const cy = clampYear(y);
      if (!cy) return;
      const iso = yearToIso(cy);

      // Try now; if engine isn’t ready yet, retry briefly.
      if (setEngineDateISO(iso)) return;

      let tries = 0;
      const t = setInterval(() => {
        tries++;
        if (setEngineDateISO(iso) || tries > 40) clearInterval(t);
      }, 250);
    }

    // ---- Receive messages from future.htm (same-origin)
    window.addEventListener("message", (ev) => {
      if (!ev.data || typeof ev.data !== "object") return;
      if (ev.data.type === "SET_YEAR") setYear(ev.data.year);
    });

    // ---- Initial year from query param
    const qsYear = new URLSearchParams(location.search).get("year");
    if (qsYear) setYear(qsYear);

    // ---- TODO: Initialize your Stellarium Web Engine / demo here.
    // If you started from apps/simple-html/, paste its initialization code here
    // (the README explicitly points you to apps/simple-html/ after `make js`). :contentReference[oaicite:2]{index=2}
  </script>
</body>
</html>

